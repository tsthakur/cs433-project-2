# cs433-project-2
The repository containing the code for the second project of Machine learning course done in fall 2023.

# Introduction

We first ran a full first-princples molecular dynamics (FPMD) calculation for 5000 time steps. This gave us the initial dataset for a first training of the model, which we called iteration 1. We originally planned to do a self-consisten training of NequIP, i.e. from this first not-so-accurate potential we ran an MD simulation, from which we would have extracted uncorrelated configurations. Onto which we would have launched first-principles calculations and which would serve to extended our dataset. But unfortunately the model was too inaccurate and the simulation exploded. So we retrained using the original FPMD trajectory by refining the hyperparameters. We called this iteration 1.2. This time the ML potential was quite accurate but took 3 whole days to train, and another day to run the MD simulation. For comparison, iteration 1 took 30 minutes to train and 3 hours to run MD simulation. Unfortunately due to the long training times, we didn't have time to do another iteration of training and running MD.

# Installation 

The file `Installation_instructions.md` contains exhaustive instructions to install all the important libraries and softwares used in this project. A brief overview of these:

- NequIP - the [code](https://github.com/mir-group/nequip) for building interatomic potentials. It is written in python and uses PyTorch for its internal model building.

- LAMMPS - the [software](https://docs.lammps.org/Manual.html) used to run molecular dynamics simulations usint the potential built with NequIP. It is written in C++ and needs to be compiled after patching for NequIP.

- Quantum ESPRESSO - the [code](https://www.quantum-espresso.org/) to run first-princples calculations that are used to generate training data. It is written in Fortran and compiling it is not trivial. We strongly recommend using the solution provided natively by the supercomputing clusters.

- AiiDA - the python [library](https://aiida.readthedocs.io/projects/aiida-core/en/latest/) to atomatically run calculations and preserve their provenance. While installing AiiDA is simple, setting up all the needed resources like profile, computer, code etc can be a time consuming process. 

- AiiDA Quantum ESPRESSO - the [plugin](https://github.com/aiidateam/aiida-quantumespresso) that interfaces Quantum ESPRESSO with AiiDA. 


# Usage

The `training` directory contains the `iteration.yaml` input files and `iteration.extxyz` training data for running two iterations of NequIP training. `deployed.pth` files are the potential files generated by NequIP that can be used by LAMMPS. `submit.sh` is the slurm script to launch the training on `piz-daint` cluster. 

The `simulations` directory contains the input file for MD simulations. Inside each directory, there is a `submit.sh` slurm script to launch MD on `piz-daint` cluster, `LBS.lmp` file containing the initial configuration generated from experimental geometry of $Li_3BS_3$, `iteration.in` input file of LAMMPS, `log.lammps` and `dump_all.lmc` the output files of the MD simulation containing thermodynamic quantities and configurations respectively.

`lammps_log_reader.py` is a simple python script to read the log file generated by LAMMPS. It is modified by us to be a standalone version of the small python library found [here](https://github.com/henriasv/lammps-logfile).

`Dataset_generation.ipynb` is the main notebook used to launch all the first-principles calculations using AiiDA and to use the output of these calculations to generate training data. Please note that this notebook will not work unless a proper AiiDA environment is set up. Even then the calculations cannot be launched as it requires having access to [piz-daint](https://www.cscs.ch/computers/piz-daint) and [LUMI-GPU](https://www.lumi-supercomputer.eu/get-started-2021/users-in-switzerland/) supercomputing clusters. For launching calculations on other clusters correct `computer` and `code` needs to be first set in AiiDA.

`Results_analysis.ipynb` is a short notebook containing the results and analysis of iteration_1 and interation_1_2 of the MD simulations.

`project_2.aiida` is an archive containing all the input and output data of first-principles calculations in this project which can be imported with AiiDA.